# Markdown Increment Acquirer

[简体中文](https://github.com/Hobrct/Markdown-Increment-Acquirer/blob/master/README.md)

## Project Background

When AIGC generates content, it uses Markdown as the markup language to enhance the readability of the text. In the front end, a Markdown parser is needed to parse it into a DOM structure. Since the content generated by AIGC is not generated all at once but in segments. For the sake of user experience, Server-Sent Events (SSE) are used to send the output content to the front end in real time, and then it is displayed by the front end.

**Existing Display Schemes**: Most of them use the form of full rendering, that is, rendering all the incoming content into a DOM and displaying it by setting the innerHTML. In Chrome, this will delete the existing DOM and create a new one to replace it, which will cause performance problems. And when you need to process the incoming data, for example, when an incoming LaTeX formula needs to be rendered out using a LaTeX rendering library. After roughly setting the innerHTML of the container, you have to re-render it. And in order to match the LaTeX formula, you have to write a plugin for the Markdown parser to make the Markdown parser match it.

**Markdown Increment Acquirer**: When it obtains the incremental content, it will compare the new tokens generated by the Markdown parser with the old ones, update the existing DOM (add, delete, and modify, with modification limited to new text additions), return the newly added text and the corresponding container. In this way, text can be appended by setting the textContent instead of updating the entire DOM, thus minimizing DOM operations. Moreover, the rendering of the newly added content is under your control. You can write the LaTeX parser inside your typewriter (or other content output classes) instead of in a Markdown plugin.

## Implementation Principles

1. Obtain the changes in content by comparing the new and old tokens.
2. Operate on the DOM according to the changed content.
3. Output a queue containing the newly added text and the corresponding containers.

## Usage

```javascript
// Get the DOM element with the id 'container' and assign it to the variable container
const container = document.getElementById('container');

// Create an instance of the increment acquirer
const mdIncrementAcquirer = markdown(container);

// Call the pushData method and assign the return value to the printTasks variable
let printTasks = markdown.pushData('attached message');

// Traverse each printTask object in the printTasks array
for (let printTask of printTasks) {
    // Append the value of the content property of the printTask object to the textContent property of the DOM element pointed to by its container property
    // This achieves the effect of adding the content in the printTask to the corresponding container element for display
    printTask.container.textContent += printTask.content;
}
```

## TODO
- Currently, it can only parse the tokens of marked.js. Support for other libraries is needed.
- The DOM generation is not completed yet. Currently, only titles, bold text, and lists are available. More Markdown styles need to be matched.
- The project structure and the README need to be optimized. A more detailed description of the implementation principles is required.
- Upload it to npm.
